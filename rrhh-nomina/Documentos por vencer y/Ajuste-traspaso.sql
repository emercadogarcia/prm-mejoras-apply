/* revision de TRASPASO DE FAMILIARES A NOMINA */

Traspaso a nomina: 
1) Tipo de empleado
2) Estado civil
Luego se debe agregar los dependientes:
 3) Cambiar tipo de relacion con la empresa = externo.
 4) Cambiar campo POR ENTERO = 2.

 -- Query que se utilizaron para ocnsultar
 
SELECT EMPRESA, CODIGO_TRABAJADOR, NOMBRE_COMPLETO,
RESERVADO_ALFA_1,IBAN_TRAB,RESERVADO_ALFA_2,RESERVADO_ALFA_3,RESERVADO_ALFA_4,RESERVADO_ALFA_5,RESERVADO_NUMBER_1, RESERVADO_NUMBER_2,RESERVADO_NUMBER_3,RESERVADO_NUMBER_4,RESERVADO_NUMBER_5
FROM rh_trabajadores
WHERE empresa = '004' 


SELECT *
from RH_TRABAJADOR_IRPF WHERE empresa = '004' and subempresa = '0401'


UPDATE RH_TRABAJADOR_IRPF
SET REG_M01='N',REG_M02='N',REG_M03='N',REG_M04='N',REG_M05='N',REG_M06='N',REG_M07='N',REG_M08='N',REG_M09='N',REG_M10='N',REG_M11='N',REG_M12='N'
WHERE empresa = '004' and subempresa = '0401' and codigo_trabajador = '00016'


/* consulta original RRHH */

Select dni, nombre_completo, auxiliar 
from RHH_PERSONAL 
WHERE auxiliar is null 
and  DNI='6877869'


SELECT /*+ FIRST_ROWS(28) */ TIPO_ID_PERSONA,DNI,NOMBRE_COMPLETO,TIPO_PERSONAL,D_TIPO_PERSONAL,NIVEL_AUTORIZACION,GRUPO,D_GRUPO,USU_CREACION,FECHA_CREACION,USU_MODIFICACION,FECHA_MODIFICACION,DNI_EXTENSION,NOMBRE,PRIMER_APELLIDO,SEGUNDO_APELLIDO,NOMBRE_ABREVIADO,NUMERO_SS,SEXO,FECHA_NACIMIENTO,ESTADO_NACIM,D_ESTADO_NACIM,PROVINCIA_NACIM,D_PROVINCIA_NACIM,LUGAR_NACIMIENTO,TELEFONO1,EXTENSION1,TELEFONO2,MOVIL_EMPRESA,EXTENSION2,MOVIL_PERSONAL,CLAVE_ID01,CLAVE_ID02,CALLE_PLAZA_AVDA,DIRECCION,NUMERO,DIRECCION_INTERIOR,PISO,LOCALIDAD,CODIGO_POSTAL,ESTADO,D_ESTADO,PROVINCIA,D_PROVINCIA,CODIGO_MUNICIPIO,MUNICIPIO,NACIONALIDAD,D_NACIONALIDAD,E_MAIL_PERSONAL,E_MAIL,AUXILIAR,CARNET_CONDUCIR,VEHICULO,FORMA_COBRO,D_FORMA_COBRO,EMP_BANCO_EMPRESA,BANCO_EMPRESA,D_BANCO_EMPRESA,BANCO_TRAB,D_BANCO_TRAB,SUCURSAL_TRAB,D_SUCURSAL_TRAB,CUENTA_TRAB,DIGITOS_TRAB,D_DIGITOS_TRAB,RESERVADO_ALFA_1,SINDICATO,D_SINDICATO,TIPO_SALARIO,D_TIPO_SALARIO,TIPO_SEMANA,D_TIPO_SEMANA,PUERTA,RRHH_EMPRESA,D_RRHH_EMPRESA,RRHH_SEDE,D_RRHH_SEDE,NUMERO_MATRICULA,ESTRUCTURA_ACTIVA,D_ESTRUCTURA_ACTIVA,PUESTO_ACTIVO,D_PUESTO_ACTIVO,DEPARTAMENTO,D_DEPARTAMENTO,CODFISCAL,D_CODFISCAL,EMPRESA_ACTUAL,SUBEMPRESA_ACTUAL,CODIGO_ACTUAL,CENTRO_ACTUAL,D_CENTRO_ACTUAL,ZONA_SALARIAL,PERIODO_NOMINA,FECHA_ALTA,FECHA_ULTIMA_BAJA,SITUACION,CONVENIO,D_CONVENIO,FECHA_CONVENIO,CATEGORIA,D_CATEGORIA,FECHA_CATEGORIA,REGIMEN,SECTOR,NOMBRE_EMPLEO,TIPO_RETRIBUCION,GRUPO_COTIZACION,D_GRUPO_COTIZACION,CLAVE_CONTRATO,CLAVE_SUBCONTRATO,NOMBRE_CONTRATO,FECHA_CONTRATO,TIEMPO_PARCIAL,PORC_HORAS,INTERNO_EXTERNO,VARIAS_ALTAS_ACTIVAS_NOMINA,EDAD,ESTADO_CIVIL,D_ESTADO_CIVIL,ANO_MATRIMONIO,DISCAPACIDAD,D_DISCAPACIDAD,GRADO_DISCAPACIDAD,TIPO_DISCAPACIDAD,D_TIPO_DISCAPACIDAD,CARNET_DISCAPACITADO,DATO_PERSONALIZADO1,DATO_PERSONALIZADO2,DATO_PERSONALIZADO3,DATO_PERSONALIZADO4,DATO_PERSONALIZADO5,DATO_PERSONALIZADO6,DATO_PERSONALIZADO7,DATO_PERSONALIZADO8,DATO_PERSONALIZADO9,DATO_PERSONALIZADO10,DATO_PERSONALIZADO11,DATO_PERSONALIZADO12,DATO_PERSONALIZADO13,DATO_PERSONALIZADO14,DATO_PERSONALIZADO15 FROM (SELECT RHH_PERSONAL.* ,rhh_pkinf_per.categoria(rhh_personal.dni,null) CATEGORIA,rhh_pkinf_per.centro(rhh_personal.dni, null) CENTRO_ACTUAL,rhh_pkinf_per.contrato(rhh_personal.dni,null) CLAVE_CONTRATO,rhh_pkinf_per.subcontrato(rhh_personal.dni,null) CLAVE_SUBCONTRATO,rhh_pkinf_permex.codigo_fiscal(rhh_personal.dni, null) CODFISCAL,rhh_pkinf_permex.trabajador(rhh_personal.dni,null) CODIGO_ACTUAL,rhh_pkinf_per.convenio(rhh_personal.dni,null) CONVENIO,rhh_pkdatosficha.devuelve_dato(null, 1, rhh_personal.dni, null) DATO_PERSONALIZADO1,rhh_pkdatosficha.devuelve_dato(null, 10, rhh_personal.dni, null) DATO_PERSONALIZADO10,rhh_pkdatosficha.devuelve_dato(null, 11, rhh_personal.dni, null) DATO_PERSONALIZADO11,rhh_pkdatosficha.devuelve_dato(null, 12, rhh_personal.dni, null) DATO_PERSONALIZADO12,rhh_pkdatosficha.devuelve_dato(null, 13, rhh_personal.dni, null) DATO_PERSONALIZADO13,rhh_pkdatosficha.devuelve_dato(null, 14, rhh_personal.dni, null) DATO_PERSONALIZADO14,rhh_pkdatosficha.devuelve_dato(null, 15, rhh_personal.dni, null) DATO_PERSONALIZADO15,rhh_pkdatosficha.devuelve_dato(null, 2, rhh_personal.dni, null) DATO_PERSONALIZADO2,rhh_pkdatosficha.devuelve_dato(null, 3, rhh_personal.dni, null) DATO_PERSONALIZADO3,rhh_pkdatosficha.devuelve_dato(null, 4, rhh_personal.dni, null) DATO_PERSONALIZADO4,rhh_pkdatosficha.devuelve_dato(null, 5, rhh_personal.dni, null) DATO_PERSONALIZADO5,rhh_pkdatosficha.devuelve_dato(null, 6, rhh_personal.dni, null) DATO_PERSONALIZADO6,rhh_pkdatosficha.devuelve_dato(null, 7, rhh_personal.dni, null) DATO_PERSONALIZADO7,rhh_pkdatosficha.devuelve_dato(null, 8, rhh_personal.dni, null) DATO_PERSONALIZADO8,rhh_pkdatosficha.devuelve_dato(null, 9, rhh_personal.dni, null) DATO_PERSONALIZADO9,rhh_pkinf_per.departamento(rhh_personal.dni, null) DEPARTAMENTO,(select b.nombre from bancos b where b.empresa=rhh_personal.emp_banco_empresa and b.codigo_rapido=rhh_personal.banco_empresa) D_BANCO_EMPRESA,(select b.nombre from bancos_csb b where b.banco_csb = rhh_personal.banco_trab and b.estado = rhh_personal.estado) D_BANCO_TRAB,rhh_pkinf_per.d_categoria(rhh_personal.dni,null) D_CATEGORIA,(select x.nombre from rh_centros x where x.codigo_centro=rhh_pkinf_per.centro(rhh_personal.dni,null) and x.codigo_empresa=rhh_pkinf_permex.empresa(rhh_personal.dni,null)) D_CENTRO_ACTUAL,(select x.nombre from rh_empresas_fiscales x where x.empresa = rhh_pkinf_permex.empresa(rhh_personal.dni, null) and x.codfis =  rhh_pkinf_permex.codigo_fiscal(rhh_personal.dni, null)) D_CODFISCAL,rhh_pkinf_per.d_convenio(rhh_personal.dni,null) D_CONVENIO,rhh_pkinf_per.d_departamento(rhh_personal.dni, null) D_DEPARTAMENTO,(SELECT nombre from rh_constantes_codigos where tipo = 'TPCTB' and codigo = digitos_trab) D_DIGITOS_TRAB,(select b.nombre from rh_constantes_codigos b where b.tipo= 'GRDISLTN' and b.codigo=rhh_personal.discapacidad) D_DISCAPACIDAD,(select b.nombre from estados b where b.codigo = rhh_personal.estado) D_ESTADO,(select b.nombre from rh_constantes_codigos b where b.tipo = 'SIFAM' and b.codigo=rhh_personal.estado_civil) D_ESTADO_CIVIL,(select b.nombre from estados b where b.codigo = rhh_personal.estado_nacim) D_ESTADO_NACIM,rhh_pkinf_per.d_estructura_activa(rhh_personal.dni, null) D_ESTRUCTURA_ACTIVA,(select b.descripcion from rh_forma_cobro b where b.codigo_forma_cobro=rhh_personal.forma_cobro) D_FORMA_COBRO,(select b.descripcion from rhh_grupos b where b.codigo=rhh_personal.grupo) D_GRUPO,rhh_pkinf_per.d_grupo_cotizacion(rhh_personal.dni,null) D_GRUPO_COTIZACION,(select b.nombre from rh_nacionalidades b where b.clave_nacionalidad=rhh_personal.nacionalidad) D_NACIONALIDAD,(select b.nombre from provincias b where b.estado=rhh_personal.estado and b.provincia=rhh_personal.provincia) D_PROVINCIA,(select b.nombre from provincias b where b.estado=rhh_personal.estado_nacim and b.provincia=rhh_personal.provincia_nacim) D_PROVINCIA_NACIM,rhh_pkinf_per.d_puesto_activo(rhh_personal.dni, null, null) D_PUESTO_ACTIVO,rhh_pkinf_per.d_rrhh_empresa(rhh_personal.dni,null, null) D_RRHH_EMPRESA,rhh_pkinf_per.d_rrhh_sede(rhh_personal.dni,null, null) D_RRHH_SEDE,(select b.nombre from rh_constantes_codigos b where b.tipo = 'SINO' and b.codigo = rhh_personal.sindicato) D_SINDICATO,(select b.nombre from sucursales_csb b where b.banco_csb = rhh_personal.banco_trab and b.sucursal_csb = rhh_personal.sucursal_trab and b.estado = rhh_personal.estado) D_SUCURSAL_TRAB,(select b.nombre from rh_constantes_codigos b where b.tipo= 'TPDIS' and b.codigo=rhh_personal.tipo_discapacidad) D_TIPO_DISCAPACIDAD,(select b.descripcion from rhh_personal_tipo b where b.tipo=rhh_pkutil01.tipo_personal_activo(rhh_personal.dni,sysdate)) D_TIPO_PERSONAL,(select b.nombre from rh_constantes_codigos b where b.tipo = 'TPSAL' and b.codigo = rhh_personal.tipo_salario) D_TIPO_SALARIO,(select b.nombre from rh_constantes_codigos b where b.tipo = 'TPSEM' and b.codigo = rhh_personal.tipo_semana) D_TIPO_SEMANA,rhh_pkinf_per.edad(rhh_personal.dni,null) EDAD,rhh_pkinf_permex.empresa(rhh_personal.dni,null) EMPRESA_ACTUAL,rhh_pkinf_per.estructura_activa(rhh_personal.dni, null) ESTRUCTURA_ACTIVA,rhh_pkinf_per.fecha_alta(rhh_personal.dni,null) FECHA_ALTA,rhh_pkinf_per.f_categoria(rhh_personal.dni,null) FECHA_CATEGORIA,rhh_pkinf_per.f_contrato(rhh_personal.dni,null) FECHA_CONTRATO,rhh_pkinf_per.f_convenio(rhh_personal.dni,null) FECHA_CONVENIO,rhh_pkinf_per.fecha_baja(rhh_personal.dni,null) FECHA_ULTIMA_BAJA,rhh_pkinf_per.grupo_cotizacion(rhh_personal.dni,null) GRUPO_COTIZACION,rhh_pkinf_per.interno_externo(rhh_personal.dni,null) INTERNO_EXTERNO,rhh_pkinf_per.d_contrato(rhh_personal.dni,null) NOMBRE_CONTRATO,rhh_pkinf_per.nombre_empleo(rhh_personal.dni,null) NOMBRE_EMPLEO,rhh_pkinf_per.numero_matricula(rhh_personal.dni,null, null) NUMERO_MATRICULA,rhh_pkinf_permex.centro_trabajo_pernom (rhh_personal.dni, null) PERIODO_NOMINA,rhh_pkinf_per.porc_horas(rhh_personal.dni,null) PORC_HORAS,rhh_pkinf_per.puesto_activo(rhh_personal.dni, null, null) PUESTO_ACTIVO,rhh_pkinf_per.regimen(rhh_personal.dni,null) REGIMEN,rhh_pkinf_per.rrhh_empresa(rhh_personal.dni,null, null) RRHH_EMPRESA,rhh_pkinf_per.rrhh_sede(rhh_personal.dni,null, null) RRHH_SEDE,rhh_pkinf_per.sector(rhh_personal.dni,null) SECTOR,rhh_pkinf_per.situacion(rhh_personal.dni,null) SITUACION,rhh_pkinf_permex.subempresa(rhh_personal.dni,sysdate) SUBEMPRESA_ACTUAL,rhh_pkinf_per.tiempo_parcial(rhh_personal.dni,null) TIEMPO_PARCIAL,rhh_pkutil01.tipo_personal_activo(rhh_personal.dni,sysdate) TIPO_PERSONAL,rhh_pkinf_per.tipo_retribucion(rhh_personal.dni,null) TIPO_RETRIBUCION,rhh_pkinf_per.varias_altas_activas_nomina(rhh_personal.dni,null) VARIAS_ALTAS_ACTIVAS_NOMINA,rhh_pkinf_permex.centro_trabajo_zona (rhh_personal.dni, null) ZONA_SALARIAL 
FROM RHH_PERSONAL) 
RHH_PERSONAL WHERE nivel_autorizacion <= 10 and exists(select 1 from rhh_permisos_grupo where usuario = 'EMERCADO' and grupo = rhh_personal.grupo) /*INIQRY*/ and (DNI='6877869')